AWS CODESTAR
=

### 서버리스?  
- 서버에 대한 고민 없이 애플리케이션을 구축 및 작동  
- 서버리스는 그 단어의 뜻처럼 서버가 없는것이 아니라 서버가 없는것 처럼 세팅이 간편해지고 있다는 뜻이다.  
    
![serverless](/images/serverless.PNG)  


### serverless computing의 이점

![positive](/images/positive.PNG)   

### 서버리스 오픈소스 프레임워크를 통한 자동 배포
- 그렇다면 이를 어떻게 하면 쉽게 코드만 작성해서 배포까지 할수 있게 되었는가? 
![framework](/images/framework.PNG)   
- 오픈소스 프레임워크들이 생겨나고 있고, AWS 에서도 이를 만들게 된것이 AWS SAM (serverless applicatioln model)이다.   
- CloudFormation 기반이고, 람다함수와 기타 리소스도 배포하며, 정해진 템플릿에서 공개표준기반 (아파치2.0)으로 만들어졌다.  

### 일반적인 개발 및 배포 단계
-일반적으로 개인이 혼자서 서버리스 앱을 만들고 개발 배포하는것이 쉬운것은 아니다.   

![normal](/images/normal.PNG)   

### AWS 기반 개발 및 배포 단계 - 통합 개발환경

- codestar와 c9으로 빠르게 서버리스 개발 및 배포 환경구축  
- 클라우드 기반 IDE를 통한 개발 협업  
- 바로 앱 패키징 및 자동 배포 가능  

![aws_dev](/images/aws_dev.png)   

### 서버리스 아키텍처 - 주요 AWS 빌딩 블록 

- 추가적으로 몇가지의 AWS 빌딩 블록들도 있는것을 알고있다면 좋다.  
![block](/images/block.PNG)   

### 서버리스 앱 개발 및 배포 과정 
* AWS CodeStar로 샘플 앱 프로젝트 (API 호출 시 간단한 HTML 파일 출력) 배포  
* 소스코드, 빌드, 배포 및 파이프라인 서비스 살펴보기
* 각종 AWS 리소스 생성 내역 확인하기
* AWS Cloud9 기반 클라우드 IDE로 수정 및 배포하기

### 데모 시작! 

#### pic1 ~ pic24

* aws 로그인 후 AWS 서비스 검색창에서 codestar를 검색한다. 
* codestar 서비스로 들어가서 화면 가운데 있는 프로젝트 시작을 선택한다. 
* 이후 나오는 선택창에서 YES를 클릭후 프로젝트 템플릿을 선택해야 한다. 
* 애플리케이션 범주를 웹 어플리케이션과 프로그래밍언어 Ruby를 선택해준다. 
* 선택 후 남은 EC2 인스턴스 와 Elastic Beanstalk중 EC2 인스턴스를 선택해준다. 
* 프로젝트 이름을 적당하게(likelion)정해주고 다른부분은 건들이지 않고 다음을 눌러준다. 
* 프로젝트 세부 정보 검토 화면 > EC2 구성은 기본적으로 t2.micro(free tier)로 되어있다. 
* 프로젝트 생성!
* 키 페어 선택을 요구한다. 새창으로 넘어가 AWS EC2 서비스로 이동한다. 
* 리소스 중에서 키 페어를 선택해준다. > 키페어 생성 클릭(likelion)
* 다시 codestar로 넘어와 키 선택창 오른쪽의 새로고침을 누르면 키를 선택할수있다. 
* 하단부 체크박스를 선택하고 프로젝트 생성을 클릭
* 코드를 편집할 방법을 선택한다. AWS에서 ALL IN ONE 하게 실행하기위해  CLOUD9을 선택해준다.
* Cloud9 환경설정을 디폴트에서 바꾸지 않고 넘겨준다. 이후 IDE 세팅과 이외의 다른 설정들을 자동으로 해준다. 첫세팅에서는 조금 오래 걸릴수도 있다. 
* 파이프라인을 선택해 들어가면 진행중인 과정들을 한눈에 볼수도 있다. 
* 1~2분까지 기다리다보면 데시보드가 생기기 시작한다. 
* 어플리케이션 엔드포인트가 나온다면 해당 엔드포인트를 선택해서 기본 설정으로 배포된 웹 어플리케이션을 확인할수있다. 
* 1~2분기다려도 완성이되지 않는다면 새로고침 한번해주면 완성된것을 확인할수 있다.
* 배포가 완료되지 않아도 엔드포인트는 생성되므로 어플리케이션이 나오지 않는다면 배포가 완료됬는지 확인한다. 
* 배포가 되는것을 잠시 기다리는 동안 주의 사항을 살펴본다. 
* 켜두었던 EC2 키페어 창에서 좌측 navbar 에서 인스턴스>인스턴스 로 이동한다. 
* 인스턴스가 두개 생성되어있다. 이는 본인의 웹 어플리케이션과 cloud9 서버에 해당한다. 프리티어 ec2 가 두개로 사용한다면 과금이 될수있으니 데모이후 삭제하거나 서버가 한개가 켜져있는 상태에서 작업하는것을 권한다. 
* 다시 codestar 대시보드로 와서 배포를 확인하면 '성공'되있고 엔드포인트 주소로 들어가면 AWS에서 설정해둔 기본 Rails 템플릿이 나오는것을 확인할수 있다. 
* 이제 코드 수정을 간단하게 하고 세션을 마무리 하겠다. 대시보드 우상단에서 코딩시작을 클릭하면  Cloud9이 켜진다. 
* 본인의 Cloud9/IDE 세팅을 우선으로 하고 코드를 수정하면된다. 
* 본인은 깃 기본 설정과 IDE 색상만 바꾸고 바로 진행 하겠다. 

#### 오류 있는 버전 pic25 ~ pic33

* 기본적으로 hello_page 컨트롤러 뷰 가 설정되어있는것을 확인할수 있다. 
* h1,h2 태그만 간단하게 바꾸어 보자 > 수정!
* 바로 깃 에드 커밋 푸시 까지해주면 바로 배포까지 자동으로 진행된다. 
* 여기서 주의 할것이 해당 터미널의 위치가 프로젝트 파일안으로 가야 한다. 
* 푸시가 끝나면 codestar 대시보드를 새로고침 해보면 커밋이 진행되고 빌드, 배포까지 자동으로 되는것을 확인할수 있다. 
* 이는 pipeline 메뉴에서 좀더 자세히 알수 있다. 
* 코드를 작성만 하면 수 분만에 배포까지 자동으로 되는것을 확인할수있다. 
* 잠시 기다려보면 코드가 빌드가 실패한것을 알수있다. 
* 코드 빌드로 들어가서 로그를 살펴보자 알고보니 기본 페이지가 템플릿으로 설정되어서 코드를 수정하면 오류가 나오는것을 알수있다. 
*  ctrl + z 로 원상태로 돌아가자! > 새로운 페이지를 임시로 만들어서 테스트 해주자.
* 다시 깃 에드 커밋 푸시
* 해당 에러를 읽어보면 spec> controller > hello_page_controller_spec.rb 파일을 보면 알수있다. 

#### 오류 없는 버전 pic34
* h2를 바꾸고 깃 에드, 커밋, 푸시 !

#### 합쳐지는 지점 pic35 ~ pic 43
* 잠시동안 커밋, 빌드, 배포를 기다려주면 페이지가 나오는것을 확인할수있다. 
* 수정까지 끝났으면 codepipeline을 조금 살펴보는것으로 마무리 해보겠다. 
* 파이프라인 우상단의 편집을 클릭
* 스테이지를 본인이 편한대로 추가/삭제/편집 할수있다.
* 간단하게 github remote를 추가해보겠다. 
* 편집: Source 오른쪽의 스테이지편집 선택
* 작업 추가(github), 공급자 github 설정 깃헙에 연결을 클릭하고, 로그인, 레포지토리 선택,브랜치 선택하고 저장
* 성공적으로 작업이 끝난것을 확인할수있다. 완료를 누르고 저장 
* 파이프라인 변경사항 저장
* 코드를 일부 수정하고 깃 에드 커밋 푸시(git push github master)를 해준다.
* codepipeline이 실행되는것을 알수있고, 리모트가 연결된 깃헙을 들어가면 코드가 반영된것이 확인된다. 
* 파이프라인이 다 실행되고 웹 어플리케이션을 새로고침하면 페이지에 변경사항이 적용된것이 확인된다.

### 데모 끝! 
* 코드스타 여러가지를 살펴보면서 기능을 좀더 탐구해보는것을 추천한다. 
* 데모가 끝났으니 EC2 에서 codestar 인스턴스를 종료해준다. 
* 해당 인스턴스를 종료할때 데이터가 사라진다고 했으나 cloud9과 연결되있고, github에도 연결되있기 때문에 데이터 걱정없이 멈추어주자
* 이제 cloud9으로 작업하고 서버 필요할때마다 켜서 사용하면 된다. 